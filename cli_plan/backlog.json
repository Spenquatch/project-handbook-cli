{
  "version": 1,
  "generated_at": "2026-02-06T19:03:41Z",
  "owner": "project-handbook",
  "purpose": "Backlog of v1 CLI planning items that are not yet scheduled into cli_plan/tasks_v1_parity.json (or require contract/spec changes first).",
  "status_values": [
    "todo",
    "in_progress",
    "done",
    "blocked",
    "deferred"
  ],
  "items": [
    {
      "id": "BL-0001",
      "status": "todo",
      "title": "Add first-class ADR commands + stronger ADR validation",
      "description": "Elevate ADRs to a first-class CLI surface by adding a dedicated `ph adr ...` command family (at minimum `ph adr add`) and strengthening ADR validation beyond the current minimal checks.",
      "scope": [
        "Add `ph adr add` to scaffold a new ADR Markdown file under `PH_ROOT/adr/` with correct filename/id alignment and required front matter.",
        "Add ADR-focused validation (either `ph adr validate` or expand `ph validate`) to enforce required headings/structure and stronger invariants (e.g. uniqueness, supersession consistency)."
      ],
      "notes": [
        "This conflicts with the current v1 ADR contract statement: humans create/edit ADRs directly and there are no `ph adr ...` commands.",
        "Implementation MUST preserve the v1 rule that `ph` does not execute repo-local code at runtime; ADR scaffolding/validation must be internal to the installed CLI."
      ],
      "requires_contract_changes": true,
      "impacted_sources_of_truth": [
        "cli_plan/v1_cli/CLI_CONTRACT.md (new `ph adr` surface)",
        "cli_plan/ph_spec/ph/adr/contract.md (creation/ownership/validation rules update)",
        "cli_plan/archive/strict_parity_2026-02/v0_make/MAKE_CONTRACT.md (parity note: v0 had no ADR target; this is a v1+ enhancement)"
      ],
      "acceptance_criteria": [
        "`ph adr add --id ADR-#### --title <t> [--status draft] [--date YYYY-MM-DD] [--force]` creates a new ADR file that passes `ph validate`.",
        "Validation enforces at least: `type: adr`, allowed `status`, filename/id alignment, unique ADR ids, and recommended required headings (configurable if needed).",
        "CLI refuses to overwrite an existing ADR unless `--force` is provided."
      ]
    },
    {
      "id": "BL-0002",
      "status": "todo",
      "title": "Refactor CLI tests away from Make-era strict output parity",
      "description": "Now that Make-era parity has been achieved, reduce brittleness by refactoring tests to focus on functional behavior (files written, exit codes, key messages) rather than byte-for-byte stdout parity (especially preamble lines and legacy formatting quirks).",
      "scope": [
        "Rename tests and helper functions to remove `make`/`parity` wording where it no longer reflects intent.",
        "Replace full-stdout equality assertions with targeted assertions: key lines present, exit codes, and output file contents/paths.",
        "Keep a small number of intentional UX contract tests (e.g. `ph help` topics) if desired, but avoid coupling most tests to exact line wrapping/spacing."
      ],
      "notes": [
        "Goal: keep coverage, reduce churn during future CLI improvements.",
        "If any commands intentionally guarantee a stable output format, document that expectation and keep strict output tests only for those commands."
      ],
      "requires_contract_changes": false,
      "impacted_sources_of_truth": [
        "tests/ (refactor assertions + naming)",
        "cli_plan/backlog.md (remove strict-parity assumptions if referenced)"
      ],
      "acceptance_criteria": [
        "All tests still pass with `uv run pytest -q` and `uv run ruff check .`.",
        "At least one test per command family remains that asserts functional behavior (outputs written, state changes) without relying on exact preamble formatting.",
        "No remaining tests are named `*_matches_make_*` or assert Make-era command strings in stdout."
      ]
    },
    {
      "id": "BL-0003",
      "status": "todo",
      "title": "Define a CLI output-testing policy (what is stable vs flexible)",
      "description": "Write down what parts of CLI output are considered stable UX contract (and therefore tested strictly) vs flexible implementation detail (tested loosely). This prevents future work from re-introducing strict-parity brittleness unintentionally.",
      "scope": [
        "Add a short testing policy doc covering: stable outputs, flexible outputs, and recommended assertion style.",
        "Optionally introduce a small snapshot mechanism (no new deps required) for the subset of outputs that should remain stable."
      ],
      "notes": [
        "This is intentionally lightweight; the goal is developer clarity, not process overhead."
      ],
      "requires_contract_changes": false,
      "impacted_sources_of_truth": [
        "cli_plan/README.md (or a new `cli_plan/testing_policy.md`)",
        "tests/ (align with policy)"
      ],
      "acceptance_criteria": [
        "A single doc exists that engineers can follow when adding/changing CLI tests.",
        "Test suite follows the policy (strict output tests limited to the explicitly stable outputs)."
      ]
    }
  ]
}
